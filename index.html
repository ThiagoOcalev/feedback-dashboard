<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woca Feedback Analyzer - IA Híbrida</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script type="module">
        // Carrega Hugging Face Transformers
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0';
        
        // Função para inicializar IA
        window.initializeAI = async function() {
            try {
                console.log('🧠 Iniciando carregamento do modelo de IA...');
                document.getElementById('aiStatus').style.display = 'block';
                document.getElementById('aiStatusText').textContent = 'Carregando modelo de análise inteligente...';
                
                // Carrega modelo multilingual de sentimentos (otimizado para português)
                window.sentimentPipeline = await pipeline(
                    'text-classification',
                    'Xenova/bert-base-multilingual-uncased-sentiment',
                    { quantized: true } // Versão menor e mais rápida
                );
                
                console.log('✅ Modelo de IA carregado com sucesso!');
                document.getElementById('aiStatusText').textContent = 'IA carregada! Análise contextual ativa.';
                document.getElementById('aiStatus').classList.add('ai-ready');
                
                // Habilita interface
                document.getElementById('uploadArea').style.pointerEvents = 'auto';
                document.getElementById('uploadArea').style.opacity = '1';
                document.querySelector('.btn-upload').disabled = false;
                
                setTimeout(() => {
                    document.getElementById('aiStatus').style.display = 'none';
                }, 3000);
                
            } catch (error) {
                console.error('❌ Erro ao carregar IA:', error);
                document.getElementById('aiStatusText').textContent = 'IA não disponível. Usando análise tradicional.';
                document.getElementById('aiStatus').classList.add('ai-error');
                
                // Habilita interface mesmo sem IA
                document.getElementById('uploadArea').style.pointerEvents = 'auto';
                document.getElementById('uploadArea').style.opacity = '1';
                document.querySelector('.btn-upload').disabled = false;
                
                setTimeout(() => {
                    document.getElementById('aiStatus').style.display = 'none';
                }, 5000);
            }
        };
        
        // Inicia carregamento da IA automaticamente
        window.addEventListener('load', () => {
            window.initializeAI();
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8f5e9 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* AI Status */
        .ai-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #e06141, #ee594a);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            box-shadow: 0 5px 20px rgba(224, 97, 65, 0.3);
            z-index: 1000;
            font-weight: bold;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        .ai-status.ai-ready {
            background: linear-gradient(135deg, #64eeb8, #4cef89);
            color: #000;
        }
        
        .ai-status.ai-error {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Upload Section */
        .upload-section {
            background: white;
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            margin: 50px auto;
            max-width: 800px;
        }
        
        .upload-title {
            font-size: 2.5em;
            color: #e06141;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .upload-subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .ai-notice {
            background: linear-gradient(135deg, #e06141, #ee594a);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: left;
        }
        
        .ai-notice h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-notice ul {
            margin: 15px 0 0 20px;
        }
        
        .ai-notice li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .upload-area {
            border: 3px dashed #e06141;
            border-radius: 15px;
            padding: 60px 20px;
            margin: 30px 0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            background: #fefcfb;
            opacity: 0.5;
            pointer-events: none;
        }
        
        .upload-area.enabled {
            opacity: 1;
            pointer-events: auto;
        }
        
        .upload-area:hover {
            border-color: #ee594a;
            background: #fff8f6;
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            border-color: #64eeb8;
            background: #f0fff0;
        }
        
        .upload-icon {
            font-size: 4em;
            color: #e06141;
            margin-bottom: 20px;
        }
        
        .upload-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .upload-hint {
            color: #666;
            font-size: 1em;
        }
        
        #fileInput {
            display: none;
        }
        
        .btn-upload {
            background: linear-gradient(135deg, #e06141, #ee594a);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .btn-upload:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-upload:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(224, 97, 65, 0.3);
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e06141;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2em;
            color: #e06141;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .loading-details {
            font-size: 1em;
            color: #666;
            margin-top: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #e06141, #ee594a);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Error */
        .error {
            display: none;
            background: #ffe6e6;
            border: 2px solid #e06141;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #c53030;
        }
        
        /* Dashboard Styles */
        .dashboard {
            display: none;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #e06141, #ee594a);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(224, 97, 65, 0.3);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .new-analysis-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .new-analysis-btn:hover {
            background: white;
            color: #e06141;
        }
        
        .ai-badge {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .summary-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .summary-label {
            color: #666;
            font-size: 1.1em;
        }
        
        .satisfeitos .summary-value { color: #64eeb8; }
        .problemas .summary-value { color: #e06141; }
        .sugestoes .summary-value { color: #ee594a; }
        .nao-classificado .summary-value { color: #999; }
        
        .main-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .category-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .category-section:hover {
            transform: translateY(-5px);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
        }
        
        .category-icon {
            font-size: 2.5em;
            margin-right: 15px;
        }
        
        .category-title {
            flex: 1;
        }
        
        .category-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .category-stats {
            color: #666;
            font-size: 1.1em;
        }
        
        .themes-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .theme-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #e06141;
        }
        
        .theme-name {
            font-weight: 600;
            color: #333;
        }
        
        .theme-count {
            background: #e06141;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .satisfeitos .theme-item { border-left-color: #64eeb8; }
        .satisfeitos .theme-count { background: #64eeb8; color: #000; }
        
        .problemas .theme-item { border-left-color: #e06141; }
        .problemas .theme-count { background: #e06141; }
        
        .sugestoes .theme-item { border-left-color: #ee594a; }
        .sugestoes .theme-count { background: #ee594a; }
        
        .examples-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        
        .examples-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .examples-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .examples-list li {
            padding: 8px 0;
            color: #555;
            line-height: 1.4;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .examples-list li:last-child {
            border-bottom: none;
        }
        
        .examples-list li::before {
            content: "💬 ";
            margin-right: 8px;
        }
        
        /* Detailed Tables */
        .detailed-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .detail-tab-btn {
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: #f0f0f0;
            color: #333;
        }
        
        .detail-tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .detail-tab-btn.active {
            background: #64eeb8;
            color: #000;
        }
        
        .detail-tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .detail-tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filter-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #64eeb8;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 14px;
        }
        
        .data-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table th {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
            line-height: 1.4;
        }
        
        .data-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .confidence-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .confidence-high {
            background: #64eeb8;
            color: #000;
        }
        
        .confidence-medium {
            background: #ffd700;
            color: #000;
        }
        
        .confidence-low {
            background: #ff9999;
            color: #000;
        }
        
        .ai-badge-small {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
            background: #e06141;
            color: white;
        }
        
        .result-counter {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .main-categories {
                grid-template-columns: 1fr;
            }
            
            .summary-value {
                font-size: 2em;
            }
            
            .upload-section {
                padding: 40px 20px;
            }
            
            .upload-title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- AI Status -->
        <div id="aiStatus" class="ai-status">
            <span id="aiStatusText">Preparando IA...</span>
        </div>
        
        <!-- Upload Section -->
        <div id="uploadSection" class="upload-section">
            <div class="upload-title">🧠 Woca Feedback Analyzer - IA Híbrida</div>
            <div class="upload-subtitle">
                Análise avançada com inteligência artificial contextual + algoritmos especializados.
                <br><strong>Formato esperado:</strong> CSV com coluna "Resposta" contendo os comentários dos usuários.
            </div>
            
            <div class="ai-notice">
                <h3>🚀 Nova Versão com IA Contextual:</h3>
                <ul>
                    <li><strong>Análise Híbrida:</strong> Combina algoritmos especializados + IA para máxima precisão</li>
                    <li><strong>Compreensão Contextual:</strong> Entende "resolve problema" vs "tenho problema"</li>
                    <li><strong>Detecção Sintática:</strong> Reconhece padrões como "disponibilizar", "gostaria que"</li>
                    <li><strong>Validação Cruzada:</strong> IA confirma classificações duvidosas</li>
                    <li><strong>100% Gratuito:</strong> Processamento local, sem custos ou APIs externas</li>
                </ul>
            </div>
            
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">📁</div>
                <div class="upload-text">Aguardando carregamento da IA...</div>
                <div class="upload-hint">A análise inteligente será ativada em instantes</div>
            </div>
            
            <input type="file" id="fileInput" accept=".csv" />
            <button class="btn-upload" onclick="document.getElementById('fileInput').click()" disabled>
                Aguardando IA...
            </button>
            
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text" id="loadingTitle">Analisando feedback com IA híbrida...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="loading-details" id="loadingDetails">Preparando análise...</div>
            </div>
            
            <div id="error" class="error">
                <strong>Erro ao processar arquivo:</strong>
                <div id="errorMessage"></div>
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboard" class="dashboard">
            <!-- Header -->
            <div class="header">
                <h1 id="dashboardTitle">🧠 Análise IA Híbrida - Woca Feedback</h1>
                <p id="dashboardSubtitle">Análise completa com inteligência artificial contextual</p>
                <div class="ai-badge" id="aiBadge">
                    🤖 <strong>IA ATIVA:</strong> Análise contextual + algoritmos especializados
                </div>
                <button class="new-analysis-btn" onclick="resetApplication()">
                    🔄 Nova Análise
                </button>
            </div>
            
            <!-- Summary -->
            <div class="summary-grid" id="summaryGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <!-- Categories -->
            <div class="main-categories" id="categoriesGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <!-- Detailed Tables -->
            <div class="detailed-section">
                <h2 style="text-align: center; color: #e06141; margin-bottom: 30px; font-size: 2em;">📋 Dados Detalhados com Análise IA</h2>
                
                <div class="tab-navigation" id="tabNavigation">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div id="tabsContent">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let processedData = null;
        let currentActiveTab = 'satisfeitos';
        let aiAnalysisEnabled = false;
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });
        
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('dragleave', handleDragLeave);
        }
        
        // Atualiza interface quando IA estiver pronta
        function enableUploadInterface() {
            const uploadArea = document.getElementById('uploadArea');
            const btnUpload = document.querySelector('.btn-upload');
            
            uploadArea.style.opacity = '1';
            uploadArea.style.pointerEvents = 'auto';
            uploadArea.querySelector('.upload-text').textContent = 'Clique aqui ou arraste seu arquivo CSV';
            uploadArea.querySelector('.upload-hint').textContent = 'Arquivo será analisado com IA contextual';
            
            btnUpload.disabled = false;
            btnUpload.textContent = 'Escolher Arquivo CSV';
            
            aiAnalysisEnabled = window.sentimentPipeline ? true : false;
            console.log('🎯 Interface habilitada. IA:', aiAnalysisEnabled ? 'ATIVA' : 'FALLBACK');
        }
        
        // Chama quando IA carregar (do script module)
        window.addEventListener('load', () => {
            // Espera um pouco para IA carregar
            setTimeout(() => {
                enableUploadInterface();
            }, 1000);
        });
        
        function handleDragOver(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }
        
        function processFile(file) {
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showError('Por favor, selecione um arquivo CSV válido.');
                return;
            }
            
            showLoading();
            updateProgress(10, 'Lendo arquivo CSV...');
            
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    try {
                        updateProgress(30, 'Arquivo carregado. Iniciando análise...');
                        analyzeData(results.data);
                    } catch (error) {
                        showError('Erro ao processar dados: ' + error.message);
                    }
                },
                error: function(error) {
                    showError('Erro ao ler arquivo CSV: ' + error.message);
                }
            });
        }
        
        function updateProgress(percent, message) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('loadingDetails').textContent = message;
        }
        
        async function analyzeData(data) {
            // Validate data structure
            if (!data || data.length === 0) {
                showError('Arquivo CSV está vazio ou não possui dados válidos.');
                return;
            }
            
            updateProgress(40, 'Validando estrutura dos dados...');
            
            // Check if 'Resposta' column exists
            const firstRow = data[0];
            if (!firstRow.hasOwnProperty('Resposta')) {
                showError('Arquivo CSV deve conter uma coluna chamada "Resposta" com os comentários.');
                return;
            }
            
            updateProgress(50, 'Filtrando respostas válidas...');
            
            // Filter valid responses
            const validResponses = data.filter(row => 
                row.Resposta && 
                typeof row.Resposta === 'string' && 
                row.Resposta.trim().length > 3
            );
            
            if (validResponses.length === 0) {
                showError('Não foram encontradas respostas válidas no arquivo.');
                return;
            }
            
            updateProgress(60, `Analisando ${validResponses.length} respostas com IA híbrida...`);
            
            // Categorize responses with AI + algorithm hybrid
            const categorizedData = await categorizeResponsesHybrid(validResponses);
            
            updateProgress(90, 'Gerando relatório...');
            
            // Store processed data
            processedData = categorizedData;
            
            // Generate dashboard
            generateDashboard(categorizedData);
            
            updateProgress(100, 'Análise concluída!');
            
            setTimeout(() => {
                hideLoading();
                showDashboard();
            }, 1000);
        }
        
        async function categorizeResponsesHybrid(responses) {
            const categories = {
                satisfeitos: [],
                problemas: [],
                sugestoes: [],
                naoClassificado: []
            };
            
            const total = responses.length;
            
            for (let i = 0; i < responses.length; i++) {
                const row = responses[i];
                
                // Update progress
                if (i % 10 === 0) {
                    const percent = 60 + Math.floor((i / total) * 25);
                    updateProgress(percent, `Analisando resposta ${i + 1} de ${total}...`);
                }
                
                // Análise híbrida: algoritmo + IA
                const result = await categorizeResponseHybrid(row.Resposta);
                const categoryKey = getCategoryKey(result.category);
                
                categories[categoryKey].push({
                    id: categories[categoryKey].length + 1,
                    resposta: row.Resposta,
                    confianca: result.confidence,
                    motivo: result.reason,
                    metodo: result.method
                });
            }
            
            return {
                total: responses.length,
                categories: categories,
                distribution: {
                    satisfeitos: categories.satisfeitos.length,
                    problemas: categories.problemas.length,
                    sugestoes: categories.sugestoes.length,
                    naoClassificado: categories.naoClassificado.length
                },
                aiEnabled: aiAnalysisEnabled
            };
        }
        
        async function categorizeResponseHybrid(resposta) {
            const texto = resposta.toLowerCase().trim();
            
            // ETAPA 1: Análise com algoritmo especializado
            const algorithmResult = categorizeResponseAdvanced(texto);
            
            // ETAPA 2: Se IA disponível E confiança baixa, validar com IA
            if (aiAnalysisEnabled && window.sentimentPipeline && algorithmResult.confidence < 0.8) {
                try {
                    const aiResult = await window.sentimentPipeline(resposta);
                    const aiSentiment = aiResult[0];
                    
                    // Combinar resultados
                    return combineAlgorithmAndAI(algorithmResult, aiSentiment, resposta);
                } catch (error) {
                    console.warn('Erro na análise IA:', error);
                    return {
                        ...algorithmResult,
                        method: 'Algoritmo (IA falhou)'
                    };
                }
            }
            
            // ETAPA 3: Se confiança alta ou IA indisponível, usar só algoritmo
            return {
                ...algorithmResult,
                method: aiAnalysisEnabled ? 'Algoritmo (alta confiança)' : 'Algoritmo (IA indisponível)'
            };
        }
        
        function combineAlgorithmAndAI(algorithmResult, aiSentiment, originalText) {
            // Mapeamento IA: POSITIVE->Satisfeito, NEGATIVE->Problema, NEUTRAL->Sugestão
            let aiCategory = 'Não Classificado';
            let aiConfidence = aiSentiment.score;
            
            if (aiSentiment.label === 'POSITIVE' && aiConfidence > 0.7) {
                aiCategory = 'Clientes Satisfeitos';
            } else if (aiSentiment.label === 'NEGATIVE' && aiConfidence > 0.7) {
                // Só considera problema se não tem padrões de sugestão
                if (!hasStrongSuggestionPatterns(originalText.toLowerCase())) {
                    aiCategory = 'Problemas Técnicos';
                }
            }
            
            // Lógica de combinação
            if (algorithmResult.confidence >= 0.7) {
                // Algoritmo tem alta confiança - manter
                return {
                    category: algorithmResult.category,
                    confidence: Math.min(0.95, algorithmResult.confidence + 0.1),
                    reason: `${algorithmResult.reason} + IA confirma (${aiSentiment.label})`,
                    method: 'Híbrido (algoritmo prioritário)'
                };
            } else if (aiCategory !== 'Não Classificado') {
                // IA tem confiança e algoritmo tem baixa confiança
                return {
                    category: aiCategory,
                    confidence: Math.min(0.85, aiConfidence),
                    reason: `IA detectou ${aiSentiment.label} (score: ${aiConfidence.toFixed(2)})`,
                    method: 'Híbrido (IA prioritária)'
                };
            } else {
                // Ambos com baixa confiança - manter algoritmo
                return {
                    category: algorithmResult.category,
                    confidence: algorithmResult.confidence * 0.8, // Reduz confiança
                    reason: `${algorithmResult.reason} + IA inconclusiva`,
                    method: 'Híbrido (inconclusivo)'
                };
            }
        }
        
        function hasStrongSuggestionPatterns(texto) {
            const strongSuggestionPatterns = [
                /^(disponibilizar|implementar|adicionar|criar|desenvolver|incluir)/i,
                /(seria bom|seria interessante|gostaria|poderia ter)/i,
                /(sugerir|sugiro|sugestão|melhorar)/i
            ];
            
            return strongSuggestionPatterns.some(pattern => pattern.test(texto));
        }
        
        function categorizeResponseAdvanced(texto) {
            // Análise de satisfação
            const satisfactionAnalysis = analyzeSatisfaction(texto);
            if (satisfactionAnalysis.isPositive) {
                return {
                    category: 'Clientes Satisfeitos',
                    confidence: satisfactionAnalysis.confidence,
                    reason: satisfactionAnalysis.reason
                };
            }
            
            // Análise de sugestões (PRIORIDADE ALTA)
            const suggestionAnalysis = analyzeSuggestions(texto);
            if (suggestionAnalysis.isSuggestion) {
                return {
                    category: 'Sugestões de Funcionalidades',
                    confidence: suggestionAnalysis.confidence,
                    reason: suggestionAnalysis.reason
                };
            }
            
            // Análise de problemas
            const problemAnalysis = analyzeProblems(texto);
            if (problemAnalysis.isProblem && !problemAnalysis.isResolved) {
                return {
                    category: 'Problemas Técnicos',
                    confidence: problemAnalysis.confidence,
                    reason: problemAnalysis.reason
                };
            }
            
            return {
                category: 'Não Classificado',
                confidence: 0.3,
                reason: 'Não se enquadra em nenhuma categoria específica'
            };
        }
        
        function analyzeSatisfaction(texto) {
            // Palavras claramente positivas
            const strongPositive = ['excelente', 'ótimo', 'perfeito', 'maravilhoso', 'fantástico', 'incrível', 'adorei', 'parabéns'];
            const mediumPositive = ['muito bom', 'muito útil', 'muito prático', 'muito fácil', 'muito legal'];
            const weakPositive = ['bom', 'legal', 'bacana', 'útil', 'prático', 'gostei', 'top', 'show'];
            
            // Contextos que indicam satisfação 
            const problemSolvingPatterns = [
                'resolve problema', 'resolveu problema', 'acabou com problema', 'elimina problema',
                'resolve questão', 'resolveu questão', 'acabou com questão', 'elimina questão',
                'resolve dificuldade', 'resolveu dificuldade', 'acabou com dificuldade', 'elimina dificuldade',
                'facilita', 'simplifica', 'agiliza', 'economiza tempo', 'poupa tempo', 'está facilitando'
            ];
            
            // Verificar padrões de resolução de problemas
            for (let pattern of problemSolvingPatterns) {
                if (texto.includes(pattern)) {
                    return {
                        isPositive: true,
                        confidence: 0.9,
                        reason: `Padrão de resolução: "${pattern}"`
                    };
                }
            }
            
            // Verificar palavras fortemente positivas
            for (let word of strongPositive) {
                if (texto.includes(word)) {
                    return {
                        isPositive: true,
                        confidence: 0.95,
                        reason: `Palavra fortemente positiva: "${word}"`
                    };
                }
            }
            
            // Verificar frases positivas médias
            for (let phrase of mediumPositive) {
                if (texto.includes(phrase)) {
                    return {
                        isPositive: true,
                        confidence: 0.85,
                        reason: `Frase positiva: "${phrase}"`
                    };
                }
            }
            
            // Verificar palavras fracamente positivas (com cuidado)
            for (let word of weakPositive) {
                if (texto === word || texto.includes(' ' + word + ' ') || texto.startsWith(word + ' ') || texto.endsWith(' ' + word)) {
                    if (!hasNegationNear(texto, word)) {
                        return {
                            isPositive: true,
                            confidence: 0.7,
                            reason: `Palavra positiva: "${word}"`
                        };
                    }
                }
            }
            
            return { isPositive: false, confidence: 0, reason: '' };
        }
        
        function analyzeSuggestions(texto) {
            // Padrões MUITO FORTES de sugestão (prioridade máxima)
            const strongSuggestionStarters = [
                /^(disponibilizar|implementar|adicionar|criar|desenvolver|incluir|inserir|colocar)/,
                /(seria bom|seria interessante|seria legal|seria útil)/,
                /(gostaria que|gostaria de|queria que)/,
                /(poderia ter|poderia incluir|poderia adicionar)/,
                /(sugiro|sugerir|sugestão)/
            ];
            
            // Verificar padrões muito fortes
            for (let pattern of strongSuggestionStarters) {
                if (pattern.test(texto)) {
                    return {
                        isSuggestion: true,
                        confidence: 0.95,
                        reason: `Padrão forte de sugestão detectado`
                    };
                }
            }
            
            // Padrões médios
            const mediumSuggestionWords = ['melhorar', 'aprimorar', 'otimizar', 'aumentar'];
            const technicalFeatures = [
                'dimensionamento', 'cálculo', 'calcular', 'dimensionar', 'conduto', 'cabo', 'fiação',
                'quadro', 'disjuntor', 'dr', 'dps', 'circuito', 'trifásico', 'monofásico',
                'autocad', 'dwg', 'dxf', 'cad', 'mobile', 'celular', 'app', 'aplicativo',
                'orçamento', 'relatório', 'pdf', 'impressão', 'norma', 'nbr'
            ];
            
            for (let word of mediumSuggestionWords) {
                if (texto.includes(word)) {
                    return {
                        isSuggestion: true,
                        confidence: 0.8,
                        reason: `Palavra de melhoria: "${word}"`
                    };
                }
            }
            
            // Características técnicas podem indicar sugestão
            for (let feature of technicalFeatures) {
                if (texto.includes(feature)) {
                    return {
                        isSuggestion: true,
                        confidence: 0.6,
                        reason: `Possível sugestão técnica: "${feature}"`
                    };
                }
            }
            
            return { isSuggestion: false, confidence: 0, reason: '' };
        }
        
        function analyzeProblems(texto) {
            const problemWords = ['erro', 'bug', 'falha', 'problema', 'dificuldade', 'não funciona', 'não carrega', 'trava', 'travando', 'lento', 'demora'];
            const resolutionWords = ['resolve', 'resolveu', 'soluciona', 'solucionou', 'elimina', 'eliminou', 'acabou com', 'corrige', 'corrigiu'];
            
            let foundProblem = false;
            let isResolved = false;
            let confidence = 0;
            let reason = '';
            
            for (let word of problemWords) {
                if (texto.includes(word)) {
                    foundProblem = true;
                    
                    // Verificar se o problema foi resolvido
                    for (let resWord of resolutionWords) {
                        if (texto.includes(resWord + ' ' + word) || texto.includes(resWord + ' o ' + word) || texto.includes(resWord + ' meu ' + word)) {
                            isResolved = true;
                            break;
                        }
                    }
                    
                    // Verificar negação
                    if (hasNegationNear(texto, word)) {
                        isResolved = true;
                        reason = `Negação detectada com "${word}"`;
                        confidence = 0.8;
                    } else if (isResolved) {
                        reason = `Problema resolvido: "${word}"`;
                        confidence = 0.6;
                    } else {
                        reason = `Problema identificado: "${word}"`;
                        confidence = 0.85;
                    }
                    break;
                }
            }
            
            return {
                isProblem: foundProblem,
                isResolved: isResolved,
                confidence: confidence,
                reason: reason
            };
        }
        
        function hasNegationNear(texto, word) {
            const negations = ['não', 'nunca', 'sem', 'zero'];
            const wordIndex = texto.indexOf(word);
            
            if (wordIndex === -1) return false;
            
            const beforeText = texto.substring(Math.max(0, wordIndex - 20), wordIndex);
            
            for (let neg of negations) {
                if (beforeText.includes(neg)) {
                    return true;
                }
            }
            
            return false;
        }
        
        function getCategoryKey(category) {
            switch(category) {
                case 'Clientes Satisfeitos': return 'satisfeitos';
                case 'Problemas Técnicos': return 'problemas';
                case 'Sugestões de Funcionalidades': return 'sugestoes';
                default: return 'naoClassificado';
            }
        }
        
        function getConfidenceBadge(confidence) {
            if (confidence >= 0.8) {
                return '<span class="confidence-badge confidence-high">Alta</span>';
            } else if (confidence >= 0.6) {
                return '<span class="confidence-badge confidence-medium">Média</span>';
            } else {
                return '<span class="confidence-badge confidence-low">Baixa</span>';
            }
        }
        
        function getMethodBadge(method) {
            if (method.includes('Híbrido')) {
                return '<span class="ai-badge-small">IA</span>';
            } else if (method.includes('Algoritmo')) {
                return '<span class="ai-badge-small" style="background: #666;">ALG</span>';
            }
            return '';
        }
        
        function generateDashboard(data) {
            // Atualizar badge IA
            const aiBadge = document.getElementById('aiBadge');
            if (data.aiEnabled) {
                aiBadge.innerHTML = '🤖 <strong>IA ATIVA:</strong> Análise híbrida (algoritmo + IA contextual)';
            } else {
                aiBadge.innerHTML = '⚠️ <strong>IA INDISPONÍVEL:</strong> Usando algoritmos avançados';
                aiBadge.style.background = 'rgba(255,255,255,0.1)';
            }
            
            generateSummary(data);
            generateCategories(data);
            generateDetailedTables(data);
        }
        
        function generateSummary(data) {
            const total = data.total;
            const dist = data.distribution;
            
            document.getElementById('dashboardSubtitle').textContent = 
                `Análise híbrida de ${total} respostas com ${data.aiEnabled ? 'IA ativa' : 'algoritmos avançados'}`;
            
            const summaryHTML = `
                <div class="summary-card satisfeitos">
                    <div class="summary-icon">😊</div>
                    <div class="summary-value">${((dist.satisfeitos/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Clientes Satisfeitos<br>${dist.satisfeitos} respostas</div>
                </div>
                
                <div class="summary-card sugestoes">
                    <div class="summary-icon">💡</div>
                    <div class="summary-value">${((dist.sugestoes/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Sugestões de Funcionalidades<br>${dist.sugestoes} respostas</div>
                </div>
                
                <div class="summary-card problemas">
                    <div class="summary-icon">⚠️</div>
                    <div class="summary-value">${((dist.problemas/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Problemas Técnicos<br>${dist.problemas} respostas</div>
                </div>
                
                <div class="summary-card nao-classificado">
                    <div class="summary-icon">❓</div>
                    <div class="summary-value">${((dist.naoClassificado/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Não Classificado<br>${dist.naoClassificado} respostas</div>
                </div>
            `;
            
            document.getElementById('summaryGrid').innerHTML = summaryHTML;
        }
        
        function generateCategories(data) {
            const satisfeitosThemes = analyzeThemes(data.categories.satisfeitos, 'satisfeitos');
            const problemasThemes = analyzeThemes(data.categories.problemas, 'problemas');
            const sugestoesThemes = analyzeThemes(data.categories.sugestoes, 'sugestoes');
            
            const categoriesHTML = `
                <!-- Clientes Satisfeitos -->
                <div class="category-section satisfeitos">
                    <div class="category-header">
                        <div class="category-icon">😊</div>
                        <div class="category-title">
                            <div class="category-name">Clientes Satisfeitos</div>
                            <div class="category-stats">${data.categories.satisfeitos.length} respostas (${((data.categories.satisfeitos.length/data.total)*100).toFixed(1)}%)</div>
                        </div>
                    </div>
                    
                    <div class="themes-grid">
                        ${satisfeitosThemes.map(theme => `
                            <div class="theme-item">
                                <span class="theme-name">${theme.name}</span>
                                <span class="theme-count">${theme.count}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="examples-section">
                        <div class="examples-title">💬 Exemplos (detectados por IA híbrida):</div>
                        <ul class="examples-list">
                            ${getHighConfidenceExamples(data.categories.satisfeitos).map(ex => `<li>${ex.resposta}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <!-- Problemas Técnicos -->
                <div class="category-section problemas">
                    <div class="category-header">
                        <div class="category-icon">⚠️</div>
                        <div class="category-title">
                            <div class="category-name">Problemas Técnicos</div>
                            <div class="category-stats">${data.categories.problemas.length} respostas (${((data.categories.problemas.length/data.total)*100).toFixed(1)}%)</div>
                        </div>
                    </div>
                    
                    <div class="themes-grid">
                        ${problemasThemes.map(theme => `
                            <div class="theme-item">
                                <span class="theme-name">${theme.name}</span>
                                <span class="theme-count">${theme.count}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="examples-section">
                        <div class="examples-title">⚠️ Principais Problemas Reais:</div>
                        <ul class="examples-list">
                            ${getHighConfidenceExamples(data.categories.problemas).slice(0, 5).map(item => `<li>${item.resposta}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <!-- Sugestões de Funcionalidades -->
                <div class="category-section sugestoes">
                    <div class="category-header">
                        <div class="category-icon">💡</div>
                        <div class="category-title">
                            <div class="category-name">Sugestões de Funcionalidades</div>
                            <div class="category-stats">${data.categories.sugestoes.length} respostas (${((data.categories.sugestoes.length/data.total)*100).toFixed(1)}%)</div>
                        </div>
                    </div>
                    
                    <div class="themes-grid">
                        ${sugestoesThemes.map(theme => `
                            <div class="theme-item">
                                <span class="theme-name">${theme.name}</span>
                                <span class="theme-count">${theme.count}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="examples-section">
                        <div class="examples-title">💡 Principais Sugestões Identificadas:</div>
                        <ul class="examples-list">
                            ${getHighConfidenceExamples(data.categories.sugestoes).slice(0, 8).map(item => `<li>${item.resposta}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('categoriesGrid').innerHTML = categoriesHTML;
        }
        
        function analyzeThemes(items, category) {
            const themes = {};
            
            items.forEach(item => {
                const texto = item.resposta.toLowerCase();
                
                if (category === 'satisfeitos') {
                    if (texto.includes('resolve') || texto.includes('resolveu') || texto.includes('elimina') || texto.includes('acabou')) {
                        themes['Resolução de Problemas'] = (themes['Resolução de Problemas'] || 0) + 1;
                    }
                    if (texto.includes('facilita') || texto.includes('fácil') || texto.includes('prático') || texto.includes('simplifica')) {
                        themes['Facilidade de Uso'] = (themes['Facilidade de Uso'] || 0) + 1;
                    }
                    if (texto.includes('tempo') || texto.includes('rápido') || texto.includes('agiliza') || texto.includes('economiza')) {
                        themes['Economia de Tempo'] = (themes['Economia de Tempo'] || 0) + 1;
                    }
                    if (texto.includes('muito bom') || texto.includes('excelente') || texto.includes('ótimo') || texto.includes('parabéns')) {
                        themes['Elogios Diretos'] = (themes['Elogios Diretos'] || 0) + 1;
                    }
                    if (texto.includes('dimensionamento') || texto.includes('cálculo') || texto.includes('calcular')) {
                        themes['Elogios ao Dimensionamento'] = (themes['Elogios ao Dimensionamento'] || 0) + 1;
                    }
                } else if (category === 'problemas') {
                    if (texto.includes('lento') || texto.includes('demora') || texto.includes('trava')) {
                        themes['Performance/Lentidão'] = (themes['Performance/Lentidão'] || 0) + 1;
                    }
                    if (texto.includes('erro') || texto.includes('bug') || texto.includes('falha')) {
                        themes['Erros/Bugs'] = (themes['Erros/Bugs'] || 0) + 1;
                    }
                    if (texto.includes('não funciona') || texto.includes('não carrega') || texto.includes('não consegue')) {
                        themes['Funcionalidades Quebradas'] = (themes['Funcionalidades Quebradas'] || 0) + 1;
                    }
                    if (texto.includes('celular') || texto.includes('mobile') || texto.includes('tablet')) {
                        themes['Problemas Mobile'] = (themes['Problemas Mobile'] || 0) + 1;
                    }
                    if (texto.includes('difícil') || texto.includes('complicado') || texto.includes('dificuldade')) {
                        themes['Dificuldade de Uso'] = (themes['Dificuldade de Uso'] || 0) + 1;
                    }
                } else if (category === 'sugestoes') {
                    if (texto.includes('dimensionamento') || texto.includes('cálculo') || texto.includes('calcular') || texto.includes('condutor')) {
                        themes['Dimensionamento/Cálculos'] = (themes['Dimensionamento/Cálculos'] || 0) + 1;
                    }
                    if (texto.includes('quadro') || texto.includes('qd') || texto.includes('distribuição') || texto.includes('disjuntor')) {
                        themes['Quadros Elétricos'] = (themes['Quadros Elétricos'] || 0) + 1;
                    }
                    if (texto.includes('orçamento') || texto.includes('custo') || texto.includes('preço') || texto.includes('material')) {
                        themes['Orçamentos/Custos'] = (themes['Orçamentos/Custos'] || 0) + 1;
                    }
                    if (texto.includes('autocad') || texto.includes('dwg') || texto.includes('dxf') || texto.includes('cad')) {
                        themes['Integração CAD'] = (themes['Integração CAD'] || 0) + 1;
                    }
                    if (texto.includes('celular') || texto.includes('mobile') || texto.includes('tablet') || texto.includes('app')) {
                        themes['Mobile/App'] = (themes['Mobile/App'] || 0) + 1;
                    }
                }
            });
            
            return Object.entries(themes)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([name, count]) => ({ name, count }));
        }
        
        function getHighConfidenceExamples(items) {
            return items
                .filter(item => item.confianca >= 0.7)
                .sort((a, b) => b.confianca - a.confianca)
                .slice(0, 8);
        }
        
        function generateDetailedTables(data) {
            // Generate navigation
            const navHTML = `
                <button class="detail-tab-btn active" onclick="showDetailTab('satisfeitos')" data-category="satisfeitos">
                    😊 Satisfeitos (${data.categories.satisfeitos.length})
                </button>
                <button class="detail-tab-btn" onclick="showDetailTab('sugestoes')" data-category="sugestoes">
                    💡 Sugestões (${data.categories.sugestoes.length})
                </button>
                <button class="detail-tab-btn" onclick="showDetailTab('problemas')" data-category="problemas">
                    ⚠️ Problemas (${data.categories.problemas.length})
                </button>
            `;
            
            document.getElementById('tabNavigation').innerHTML = navHTML;
            
            // Generate table content
            const tabsHTML = `
                ${generateTabContent('satisfeitos', data.categories.satisfeitos, 'Clientes Satisfeitos', '#64eeb8', '#000')}
                ${generateTabContent('sugestoes', data.categories.sugestoes, 'Sugestões de Funcionalidades', '#ee594a', 'white')}
                ${generateTabContent('problemas', data.categories.problemas, 'Problemas Técnicos', '#e06141', 'white')}
            `;
            
            document.getElementById('tabsContent').innerHTML = tabsHTML;
        }
        
        function generateTabContent(categoryKey, items, categoryName, headerColor, textColor) {
            const isActive = categoryKey === 'satisfeitos' ? 'active' : '';
            const style = categoryKey === 'satisfeitos' ? '' : 'style="display: none;"';
            
            return `
                <div id="${categoryKey}-detail" class="detail-tab-content ${isActive}" ${style}>
                    <div style="background: linear-gradient(135deg, ${headerColor}20, ${headerColor}10); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: ${headerColor}; margin: 0 0 10px 0;">${categoryName} - ${items.length} respostas</h3>
                        <p style="margin: 0; color: #555;">Respostas analisadas com IA híbrida (algoritmo + inteligência artificial contextual).</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <input type="text" id="filter-${categoryKey}" placeholder="🔍 Filtrar respostas..." 
                               class="filter-input" 
                               onkeyup="filterTable('${categoryKey}')"
                               style="border-color: ${headerColor};">
                    </div>
                    
                    <div class="table-container">
                        <table id="table-${categoryKey}" class="data-table">
                            <thead>
                                <tr style="background: ${headerColor}; color: ${textColor};">
                                    <th style="width: 50px;">#</th>
                                    <th>Resposta</th>
                                    <th style="width: 80px;">Confiança</th>
                                    <th style="width: 70px;">Método</th>
                                    <th style="width: 200px;">Motivo da Classificação</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-${categoryKey}">
                                ${items.map(item => `
                                    <tr>
                                        <td style="font-weight: bold; color: #666;">${item.id}</td>
                                        <td>${item.resposta}</td>
                                        <td>${getConfidenceBadge(item.confianca)}</td>
                                        <td>${getMethodBadge(item.metodo)}</td>
                                        <td style="font-size: 12px; color: #666;">${item.motivo}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div class="result-counter">
                            Mostrando ${items.length} de ${items.length} respostas analisadas com IA híbrida
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showDetailTab(category) {
            // Hide all tabs
            document.querySelectorAll('.detail-tab-content').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.detail-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = '#f0f0f0';
                btn.style.color = '#333';
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(category + '-detail');
            selectedTab.style.display = 'block';
            selectedTab.classList.add('active');
            
            // Activate button
            const activeButton = event.target;
            activeButton.classList.add('active');
            
            // Set button colors
            if (category === 'satisfeitos') {
                activeButton.style.background = '#64eeb8';
                activeButton.style.color = '#000';
            } else if (category === 'sugestoes') {
                activeButton.style.background = '#ee594a';
                activeButton.style.color = 'white';
            } else if (category === 'problemas') {
                activeButton.style.background = '#e06141';
                activeButton.style.color = 'white';
            }
            
            currentActiveTab = category;
        }
        
        function filterTable(category) {
            const filter = document.getElementById('filter-' + category);
            const table = document.getElementById('table-' + category);
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');
            
            const searchTerm = filter.value.toLowerCase();
            
            let visibleCount = 0;
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update counter
            const counter = table.parentElement.querySelector('.result-counter');
            counter.textContent = `Mostrando ${visibleCount} de ${rows.length} respostas analisadas com IA híbrida`;
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function showError(message) {
            document.getElementById('error').style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
            hideLoading();
        }
        
        function showDashboard() {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }
        
        function resetApplication() {
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('fileInput').value = '';
            processedData = null;
            currentActiveTab = 'satisfeitos';
            
            // Re-enable interface if AI was loaded
            if (aiAnalysisEnabled || window.sentimentPipeline) {
                enableUploadInterface();
            }
        }
    </script>
</body>
</html>