<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woca Feedback Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8f5e9 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Upload Section */
        .upload-section {
            background: white;
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            margin: 50px auto;
            max-width: 800px;
        }
        
        .upload-title {
            font-size: 2.5em;
            color: #e06141;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .upload-subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .upload-area {
            border: 3px dashed #e06141;
            border-radius: 15px;
            padding: 60px 20px;
            margin: 30px 0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            background: #fefcfb;
        }
        
        .upload-area:hover {
            border-color: #ee594a;
            background: #fff8f6;
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            border-color: #64eeb8;
            background: #f0fff0;
        }
        
        .upload-icon {
            font-size: 4em;
            color: #e06141;
            margin-bottom: 20px;
        }
        
        .upload-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .upload-hint {
            color: #666;
            font-size: 1em;
        }
        
        #fileInput {
            display: none;
        }
        
        .btn-upload {
            background: linear-gradient(135deg, #e06141, #ee594a);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .btn-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(224, 97, 65, 0.3);
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e06141;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2em;
            color: #e06141;
            font-weight: bold;
        }
        
        /* Error */
        .error {
            display: none;
            background: #ffe6e6;
            border: 2px solid #e06141;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #c53030;
        }
        
        /* Dashboard Styles */
        .dashboard {
            display: none;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #e06141, #ee594a);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(224, 97, 65, 0.3);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .new-analysis-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .new-analysis-btn:hover {
            background: white;
            color: #e06141;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .summary-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .summary-label {
            color: #666;
            font-size: 1.1em;
        }
        
        .satisfeitos .summary-value { color: #64eeb8; }
        .problemas .summary-value { color: #e06141; }
        .sugestoes .summary-value { color: #ee594a; }
        .nao-classificado .summary-value { color: #999; }
        
        .main-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .category-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .category-section:hover {
            transform: translateY(-5px);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
        }
        
        .category-icon {
            font-size: 2.5em;
            margin-right: 15px;
        }
        
        .category-title {
            flex: 1;
        }
        
        .category-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .category-stats {
            color: #666;
            font-size: 1.1em;
        }
        
        .themes-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .theme-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #e06141;
        }
        
        .theme-name {
            font-weight: 600;
            color: #333;
        }
        
        .theme-count {
            background: #e06141;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .satisfeitos .theme-item { border-left-color: #64eeb8; }
        .satisfeitos .theme-count { background: #64eeb8; color: #000; }
        
        .problemas .theme-item { border-left-color: #e06141; }
        .problemas .theme-count { background: #e06141; }
        
        .sugestoes .theme-item { border-left-color: #ee594a; }
        .sugestoes .theme-count { background: #ee594a; }
        
        .examples-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        
        .examples-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .examples-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .examples-list li {
            padding: 8px 0;
            color: #555;
            line-height: 1.4;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .examples-list li:last-child {
            border-bottom: none;
        }
        
        .examples-list li::before {
            content: "💬 ";
            margin-right: 8px;
        }
        
        /* Detailed Tables */
        .detailed-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .detail-tab-btn {
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: #f0f0f0;
            color: #333;
        }
        
        .detail-tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .detail-tab-btn.active {
            background: #64eeb8;
            color: #000;
        }
        
        .detail-tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .detail-tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filter-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #64eeb8;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 14px;
        }
        
        .data-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table th {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
            line-height: 1.4;
        }
        
        .data-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .result-counter {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .main-categories {
                grid-template-columns: 1fr;
            }
            
            .summary-value {
                font-size: 2em;
            }
            
            .upload-section {
                padding: 40px 20px;
            }
            
            .upload-title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Upload Section -->
        <div id="uploadSection" class="upload-section">
            <div class="upload-title">📊 Woca Feedback Analyzer</div>
            <div class="upload-subtitle">
                Faça upload do seu arquivo CSV com respostas de feedback e receba uma análise completa automaticamente.
                <br><strong>Formato esperado:</strong> CSV com coluna "Resposta" contendo os comentários dos usuários.
            </div>
            
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">📁</div>
                <div class="upload-text">Clique aqui ou arraste seu arquivo CSV</div>
                <div class="upload-hint">Arquivo deve ter coluna "Resposta" com os comentários</div>
            </div>
            
            <input type="file" id="fileInput" accept=".csv" />
            <button class="btn-upload" onclick="document.getElementById('fileInput').click()">
                Escolher Arquivo CSV
            </button>
            
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Analisando feedback... Isso pode levar alguns segundos.</div>
            </div>
            
            <div id="error" class="error">
                <strong>Erro ao processar arquivo:</strong>
                <div id="errorMessage"></div>
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboard" class="dashboard">
            <!-- Header -->
            <div class="header">
                <h1 id="dashboardTitle">📊 Análise de Feedback</h1>
                <p id="dashboardSubtitle">Análise completa das respostas processadas</p>
                <button class="new-analysis-btn" onclick="resetApplication()">
                    🔄 Nova Análise
                </button>
            </div>
            
            <!-- Summary -->
            <div class="summary-grid" id="summaryGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <!-- Categories -->
            <div class="main-categories" id="categoriesGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <!-- Detailed Tables -->
            <div class="detailed-section">
                <h2 style="text-align: center; color: #e06141; margin-bottom: 30px; font-size: 2em;">📋 Dados Detalhados por Categoria</h2>
                
                <div class="tab-navigation" id="tabNavigation">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div id="tabsContent">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let processedData = null;
        let currentActiveTab = 'satisfeitos';
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });
        
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('dragleave', handleDragLeave);
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }
        
        function processFile(file) {
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showError('Por favor, selecione um arquivo CSV válido.');
                return;
            }
            
            showLoading();
            
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    try {
                        analyzeData(results.data);
                    } catch (error) {
                        showError('Erro ao processar dados: ' + error.message);
                    }
                },
                error: function(error) {
                    showError('Erro ao ler arquivo CSV: ' + error.message);
                }
            });
        }
        
        function analyzeData(data) {
            // Validate data structure
            if (!data || data.length === 0) {
                showError('Arquivo CSV está vazio ou não possui dados válidos.');
                return;
            }
            
            // Check if 'Resposta' column exists
            const firstRow = data[0];
            if (!firstRow.hasOwnProperty('Resposta')) {
                showError('Arquivo CSV deve conter uma coluna chamada "Resposta" com os comentários.');
                return;
            }
            
            // Filter valid responses
            const validResponses = data.filter(row => 
                row.Resposta && 
                typeof row.Resposta === 'string' && 
                row.Resposta.trim().length > 3
            );
            
            if (validResponses.length === 0) {
                showError('Não foram encontradas respostas válidas no arquivo.');
                return;
            }
            
            // Categorize responses
            const categorizedData = categorizeResponses(validResponses);
            
            // Store processed data
            processedData = categorizedData;
            
            // Generate dashboard
            generateDashboard(categorizedData);
            
            hideLoading();
            showDashboard();
        }
        
        function categorizeResponses(responses) {
            const categories = {
                satisfeitos: [],
                problemas: [],
                sugestoes: [],
                naoClassificado: []
            };
            
            responses.forEach((row, index) => {
                const category = categorizeResponse(row.Resposta);
                const categoryKey = getCategoryKey(category);
                
                categories[categoryKey].push({
                    id: categories[categoryKey].length + 1,
                    resposta: row.Resposta
                });
            });
            
            return {
                total: responses.length,
                categories: categories,
                distribution: {
                    satisfeitos: categories.satisfeitos.length,
                    problemas: categories.problemas.length,
                    sugestoes: categories.sugestoes.length,
                    naoClassificado: categories.naoClassificado.length
                }
            };
        }
        
        function categorizeResponse(resposta) {
            const texto = resposta.toLowerCase().trim();
            
            // 1. CLIENTES SATISFEITOS
            if ([
                'muito bom', 'excelente', 'ótimo', 'perfeito', 'satisfeito', 'gostei', 'parabéns', 
                'continue assim', 'top', 'show', 'adorei', 'maravilhoso', 'fantástico', 'incrível',
                'está bom', 'tudo bem', 'está ótimo', 'muito útil', 'ajuda muito', 'facilita muito',
                'economia', 'economiza tempo', 'agiliza', 'prático', 'útil', 'bom programa',
                'bom', 'legal', 'bacana', 'massa', 'maneiro', 'aprovado', 'recomendo', 'positivo', 'satisfatório', 'aproveitoso'
            ].some(p => {
                if (['bom', 'legal', 'top', 'show'].includes(p)) {
                    return texto === p || texto.includes(' ' + p + ' ') || texto.startsWith(p + ' ') || texto.endsWith(' ' + p);
                }
                return texto.includes(p);
            })) {
                return 'Clientes Satisfeitos';
            }
            
            // 2. PROBLEMAS TÉCNICOS
            if ([
                'erro', 'bug', 'problema', 'não funciona', 'falha', 'travando', 'lento', 'trava',
                'não carrega', 'não abre', 'demora', 'não consegue', 'não consigo', 'dificuldade',
                'complicado', 'difícil', 'não está funcionando', 'não roda', 'não salva'
            ].some(p => texto.includes(p))) {
                return 'Problemas Técnicos';
            }
            
            // 3. SUGESTÕES DE FUNCIONALIDADES
            if ([
                'adicionar', 'implementar', 'incluir', 'criar', 'desenvolver', 'possibilidade',
                'gostaria', 'seria bom', 'seria interessante', 'sugestão', 'funcionalidade',
                'inserir', 'colocar', 'melhorar', 'aprimorar', 'otimizar', 'aumentar',
                'dimensionamento', 'cálculo', 'calcular', 'dimensionar', 'conduto', 'cabo', 
                'fiação', 'bitola', 'condutor', 'seção', 'quadro', 'qd', 'qgbt', 'distribuição',
                'disjuntor', 'dr', 'dps', 'proteção', 'circuito', 'trifásico', 'monofásico',
                'imprimir', 'impressão', 'relatório', 'lista de materiais', 'pdf', 'exportar',
                'autocad', 'dwg', 'dxf', 'cad', 'celular', 'mobile', 'smartphone', 'tablet',
                'aplicativo', 'app', 'norma', 'nbr', 'técnica', 'abnt', 'spda', 'aterramento',
                'iluminação', 'lâmpada', 'luz', 'luminária', 'interruptor', 'tomada',
                'orçamento', 'custo', 'preço', 'material', 'simbologia', 'símbolo',
                'tutorial', 'curso', 'treinamento', 'interface', 'layout', 'design',
                'projeto', 'planta', 'escala', 'medidas', 'automação'
            ].some(p => texto.includes(p))) {
                return 'Sugestões de Funcionalidades';
            }
            
            return 'Não Classificado';
        }
        
        function getCategoryKey(category) {
            switch(category) {
                case 'Clientes Satisfeitos': return 'satisfeitos';
                case 'Problemas Técnicos': return 'problemas';
                case 'Sugestões de Funcionalidades': return 'sugestoes';
                default: return 'naoClassificado';
            }
        }
        
        function generateDashboard(data) {
            generateSummary(data);
            generateCategories(data);
            generateDetailedTables(data);
        }
        
        function generateSummary(data) {
            const total = data.total;
            const dist = data.distribution;
            
            document.getElementById('dashboardSubtitle').textContent = 
                `Análise de ${total} respostas válidas processadas automaticamente`;
            
            const summaryHTML = `
                <div class="summary-card satisfeitos">
                    <div class="summary-icon">😊</div>
                    <div class="summary-value">${((dist.satisfeitos/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Clientes Satisfeitos<br>${dist.satisfeitos} respostas</div>
                </div>
                
                <div class="summary-card sugestoes">
                    <div class="summary-icon">💡</div>
                    <div class="summary-value">${((dist.sugestoes/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Sugestões de Funcionalidades<br>${dist.sugestoes} respostas</div>
                </div>
                
                <div class="summary-card problemas">
                    <div class="summary-icon">⚠️</div>
                    <div class="summary-value">${((dist.problemas/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Problemas Técnicos<br>${dist.problemas} respostas</div>
                </div>
                
                <div class="summary-card nao-classificado">
                    <div class="summary-icon">❓</div>
                    <div class="summary-value">${((dist.naoClassificado/total)*100).toFixed(1)}%</div>
                    <div class="summary-label">Não Classificado<br>${dist.naoClassificado} respostas</div>
                </div>
            `;
            
            document.getElementById('summaryGrid').innerHTML = summaryHTML;
        }
        
        function generateCategories(data) {
            const satisfeitosThemes = analyzeThemes(data.categories.satisfeitos, 'satisfeitos');
            const problemasThemes = analyzeThemes(data.categories.problemas, 'problemas');
            const sugestoesThemes = analyzeThemes(data.categories.sugestoes, 'sugestoes');
            
            const categoriesHTML = `
                <!-- Clientes Satisfeitos -->
                <div class="category-section satisfeitos">
                    <div class="category-header">
                        <div class="category-icon">😊</div>
                        <div class="category-title">
                            <div class="category-name">Clientes Satisfeitos</div>
                            <div class="category-stats">${data.categories.satisfeitos.length} respostas (${((data.categories.satisfeitos.length/data.total)*100).toFixed(1)}%)</div>
                        </div>
                    </div>
                    
                    <div class="themes-grid">
                        ${satisfeitosThemes.map(theme => `
                            <div class="theme-item">
                                <span class="theme-name">${theme.name}</span>
                                <span class="theme-count">${theme.count}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="examples-section">
                        <div class="examples-title">💬 Exemplos de Satisfação (com motivos):</div>
                        <ul class="examples-list">
                            ${getSubstantialExamples(data.categories.satisfeitos).map(ex => `<li>${ex}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <!-- Problemas Técnicos -->
                <div class="category-section problemas">
                    <div class="category-header">
                        <div class="category-icon">⚠️</div>
                        <div class="category-title">
                            <div class="category-name">Problemas Técnicos</div>
                            <div class="category-stats">${data.categories.problemas.length} respostas (${((data.categories.problemas.length/data.total)*100).toFixed(1)}%)</div>
                        </div>
                    </div>
                    
                    <div class="themes-grid">
                        ${problemasThemes.map(theme => `
                            <div class="theme-item">
                                <span class="theme-name">${theme.name}</span>
                                <span class="theme-count">${theme.count}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="examples-section">
                        <div class="examples-title">⚠️ Principais Problemas:</div>
                        <ul class="examples-list">
                            ${data.categories.problemas.slice(0, 5).map(item => `<li>${item.resposta}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <!-- Sugestões de Funcionalidades -->
                <div class="category-section sugestoes">
                    <div class="category-header">
                        <div class="category-icon">💡</div>
                        <div class="category-title">
                            <div class="category-name">Sugestões de Funcionalidades</div>
                            <div class="category-stats">${data.categories.sugestoes.length} respostas (${((data.categories.sugestoes.length/data.total)*100).toFixed(1)}%)</div>
                        </div>
                    </div>
                    
                    <div class="themes-grid">
                        ${sugestoesThemes.map(theme => `
                            <div class="theme-item">
                                <span class="theme-name">${theme.name}</span>
                                <span class="theme-count">${theme.count}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="examples-section">
                        <div class="examples-title">💡 Principais Sugestões:</div>
                        <ul class="examples-list">
                            ${data.categories.sugestoes.slice(0, 8).map(item => `<li>${item.resposta}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('categoriesGrid').innerHTML = categoriesHTML;
        }
        
        function analyzeThemes(items, category) {
            const themes = {};
            
            items.forEach(item => {
                const texto = item.resposta.toLowerCase();
                
                if (category === 'satisfeitos') {
                    if (texto.includes('dimensionamento') || texto.includes('cálculo') || texto.includes('calcular')) {
                        themes['Elogios ao Dimensionamento'] = (themes['Elogios ao Dimensionamento'] || 0) + 1;
                    }
                    if (texto.includes('facilita') || texto.includes('fácil') || texto.includes('prático')) {
                        themes['Facilidade de Uso'] = (themes['Facilidade de Uso'] || 0) + 1;
                    }
                    if (texto.includes('tempo') || texto.includes('rápido') || texto.includes('agiliza')) {
                        themes['Economia de Tempo'] = (themes['Economia de Tempo'] || 0) + 1;
                    }
                    if (texto.includes('projeto') || texto.includes('trabalho') || texto.includes('ajuda')) {
                        themes['Ajuda nos Projetos'] = (themes['Ajuda nos Projetos'] || 0) + 1;
                    }
                    if (texto.includes('muito bom') || texto.includes('excelente') || texto.includes('ótimo') || texto.includes('parabéns') || ['bom', 'legal', 'top', 'show'].some(p => texto === p)) {
                        themes['Elogios Gerais'] = (themes['Elogios Gerais'] || 0) + 1;
                    }
                } else if (category === 'problemas') {
                    if (texto.includes('lento') || texto.includes('demora') || texto.includes('trava')) {
                        themes['Performance/Lentidão'] = (themes['Performance/Lentidão'] || 0) + 1;
                    }
                    if (texto.includes('erro') || texto.includes('bug') || texto.includes('falha')) {
                        themes['Erros/Bugs'] = (themes['Erros/Bugs'] || 0) + 1;
                    }
                    if (texto.includes('não funciona') || texto.includes('não carrega') || texto.includes('não consegue')) {
                        themes['Funcionalidades Quebradas'] = (themes['Funcionalidades Quebradas'] || 0) + 1;
                    }
                    if (texto.includes('celular') || texto.includes('mobile') || texto.includes('tablet')) {
                        themes['Problemas Mobile'] = (themes['Problemas Mobile'] || 0) + 1;
                    }
                    if (texto.includes('difícil') || texto.includes('complicado') || texto.includes('dificuldade')) {
                        themes['Dificuldade de Uso'] = (themes['Dificuldade de Uso'] || 0) + 1;
                    }
                } else if (category === 'sugestoes') {
                    if (texto.includes('dimensionamento') || texto.includes('cálculo') || texto.includes('calcular') || texto.includes('condutor') || texto.includes('cabo')) {
                        themes['Dimensionamento/Cálculos'] = (themes['Dimensionamento/Cálculos'] || 0) + 1;
                    }
                    if (texto.includes('quadro') || texto.includes('qd') || texto.includes('distribuição') || texto.includes('disjuntor') || texto.includes('dr')) {
                        themes['Quadros Elétricos'] = (themes['Quadros Elétricos'] || 0) + 1;
                    }
                    if (texto.includes('orçamento') || texto.includes('custo') || texto.includes('preço') || texto.includes('material')) {
                        themes['Orçamentos/Custos'] = (themes['Orçamentos/Custos'] || 0) + 1;
                    }
                    if (texto.includes('autocad') || texto.includes('dwg') || texto.includes('dxf') || texto.includes('cad')) {
                        themes['Integração CAD'] = (themes['Integração CAD'] || 0) + 1;
                    }
                    if (texto.includes('relatório') || texto.includes('pdf') || texto.includes('imprimir') || texto.includes('lista')) {
                        themes['Relatórios/Impressão'] = (themes['Relatórios/Impressão'] || 0) + 1;
                    }
                    if (texto.includes('símbolo') || texto.includes('simbologia') || texto.includes('interruptor') || texto.includes('tomada')) {
                        themes['Símbolos/Componentes'] = (themes['Símbolos/Componentes'] || 0) + 1;
                    }
                    if (texto.includes('celular') || texto.includes('mobile') || texto.includes('tablet') || texto.includes('app')) {
                        themes['Mobile/App'] = (themes['Mobile/App'] || 0) + 1;
                    }
                    if (texto.includes('iluminação') || texto.includes('lâmpada') || texto.includes('luz') || texto.includes('luminária')) {
                        themes['Iluminação'] = (themes['Iluminação'] || 0) + 1;
                    }
                }
            });
            
            return Object.entries(themes)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([name, count]) => ({ name, count }));
        }
        
        function getSubstantialExamples(items) {
            return items
                .filter(item => item.resposta.length > 20) // Only substantial responses
                .slice(0, 8)
                .map(item => item.resposta);
        }
        
        function generateDetailedTables(data) {
            // Generate navigation
            const navHTML = `
                <button class="detail-tab-btn active" onclick="showDetailTab('satisfeitos')" data-category="satisfeitos">
                    😊 Satisfeitos (${data.categories.satisfeitos.length})
                </button>
                <button class="detail-tab-btn" onclick="showDetailTab('sugestoes')" data-category="sugestoes">
                    💡 Sugestões (${data.categories.sugestoes.length})
                </button>
                <button class="detail-tab-btn" onclick="showDetailTab('problemas')" data-category="problemas">
                    ⚠️ Problemas (${data.categories.problemas.length})
                </button>
            `;
            
            document.getElementById('tabNavigation').innerHTML = navHTML;
            
            // Generate table content
            const tabsHTML = `
                ${generateTabContent('satisfeitos', data.categories.satisfeitos, 'Clientes Satisfeitos', '#64eeb8', '#000')}
                ${generateTabContent('sugestoes', data.categories.sugestoes, 'Sugestões de Funcionalidades', '#ee594a', 'white')}
                ${generateTabContent('problemas', data.categories.problemas, 'Problemas Técnicos', '#e06141', 'white')}
            `;
            
            document.getElementById('tabsContent').innerHTML = tabsHTML;
        }
        
        function generateTabContent(categoryKey, items, categoryName, headerColor, textColor) {
            const isActive = categoryKey === 'satisfeitos' ? 'active' : '';
            const style = categoryKey === 'satisfeitos' ? '' : 'style="display: none;"';
            
            return `
                <div id="${categoryKey}-detail" class="detail-tab-content ${isActive}" ${style}>
                    <div style="background: linear-gradient(135deg, ${headerColor}20, ${headerColor}10); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: ${headerColor}; margin: 0 0 10px 0;">${categoryName} - ${items.length} respostas</h3>
                        <p style="margin: 0; color: #555;">Todas as respostas desta categoria listadas abaixo.</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <input type="text" id="filter-${categoryKey}" placeholder="🔍 Filtrar respostas..." 
                               class="filter-input" 
                               onkeyup="filterTable('${categoryKey}')"
                               style="border-color: ${headerColor};">
                    </div>
                    
                    <div class="table-container">
                        <table id="table-${categoryKey}" class="data-table">
                            <thead>
                                <tr style="background: ${headerColor}; color: ${textColor};">
                                    <th style="width: 60px;">#</th>
                                    <th>Resposta</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-${categoryKey}">
                                ${items.map(item => `
                                    <tr>
                                        <td style="font-weight: bold; color: #666;">${item.id}</td>
                                        <td>${item.resposta}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div class="result-counter">
                            Mostrando ${items.length} de ${items.length} respostas
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showDetailTab(category) {
            // Hide all tabs
            document.querySelectorAll('.detail-tab-content').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.detail-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = '#f0f0f0';
                btn.style.color = '#333';
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(category + '-detail');
            selectedTab.style.display = 'block';
            selectedTab.classList.add('active');
            
            // Activate button
            const activeButton = event.target;
            activeButton.classList.add('active');
            
            // Set button colors
            if (category === 'satisfeitos') {
                activeButton.style.background = '#64eeb8';
                activeButton.style.color = '#000';
            } else if (category === 'sugestoes') {
                activeButton.style.background = '#ee594a';
                activeButton.style.color = 'white';
            } else if (category === 'problemas') {
                activeButton.style.background = '#e06141';
                activeButton.style.color = 'white';
            }
            
            currentActiveTab = category;
        }
        
        function filterTable(category) {
            const filter = document.getElementById('filter-' + category);
            const table = document.getElementById('table-' + category);
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');
            
            const searchTerm = filter.value.toLowerCase();
            
            let visibleCount = 0;
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update counter
            const counter = table.parentElement.querySelector('.result-counter');
            counter.textContent = `Mostrando ${visibleCount} de ${rows.length} respostas`;
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function showError(message) {
            document.getElementById('error').style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
            hideLoading();
        }
        
        function showDashboard() {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }
        
        function resetApplication() {
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('fileInput').value = '';
            processedData = null;
            currentActiveTab = 'satisfeitos';
        }
    </script>
</body>
</html>